% DP 题选讲
% Wearry

# ARC074 E RGB Sequence

给你一个长度为$N$的序列和$M$组约束条件, 每组条件形如$L_i, R_i, X_i$, 
表示序列上的$[L_i, R_i]$中恰好有$X_i$种颜色, 现在要你用三种颜色给这个序列染色, 求满足所有约束的方案数.

\vspace {2ex}
$N, M \le 300$

---

# ARC074 E RGB Sequence

如果给定序列求区间中的颜色数, 
可以对每个右端点, 记录它向左第一次出现某种颜色的位置.
按照类似的方式定义状态 $f_{i, r, g, b}$ 表示当前考虑到序列的第 $i$ 个位置, 
每种颜色最后一次出现位置分别是 $r, g, b$ 的方案数, 然后每个把约束挂在右端点上, 就可以删去不合法的状态.

\vspace {2ex}

. . .

不难发现对于一个合法的状态, 一定有 $i = \max\{r, g, b\}$, 可以省掉一维, 复杂度 $O(N^3 + N^2M)$.

---

# ARC086 E Smuggling Marbles

给出一棵 $N$ 个点的有根树, 初始时其中一些点上有一个石子, 
每次同时将所有石子从所在的点移动到父亲上, 根节点上的石子移动到篮子里.
如果有一个点上的石子数大于 $1$ 则移除所有石子, 树上没有石子时结束.
求所有 $2^N$ 种初始局面经过操作后篮子里石子的期望数量.

\vspace {2ex}

$N \le 2 \times 10^5$

---

# ARC086 E Smuggling Marbles

显然的一点是深度不同的点之间不会产生影响, 可以分开考虑.

. . .

### 解法一

一条从上到下的链不会影响石子的状态, 
所以可以对于每一个深度的点建虚树然后在虚树上DP即可, 这样虚树的总点数是 $O(N)$ 的.

. . .

### 解法二

可以维护子树内每个深度的信息, 然后相同深度的可以合并, 
看起来是 $O(N^2)$ 的, 可以使用长链剖分的技巧优化到 $O(N)$.

---

# ARC078 F Mole and Abandoned Mine

给出一个$N$ 个点$M$ 条边的简单无向联通图。

要求删除一些边使得$1$ 号点到$N$ 号点的简单路径唯一，求删去的最小边权和。

\vspace{2ex}

$1 \le N \le 15, 1 \le M \le \frac{N(N-1)}{2}$

---

# ARC078 F Mole and Abandoned Mine

考虑满足条件的图的一般形式，发现一定基于一条$1 \rightarrow N$ 的链。

然后为保证路径数唯一，链上两点不能通过非链上的边联通，图就会变成这样:

. . .

\begin{center}
    \includegraphics[width=5cm]{graph.png}
\end{center}

---

# ARC078 F Mole and Abandoned Mine

记$dp(s, t)$表示当前在图中的点集为$s$，链上的最后一个点为$t$ 的最大边权。

转移有两种情况:

- 枚举一个没有访问过的点，将其作为链的终点。
- 枚举一个没有访问过的点集，将其接在当前的链的终点上。

---

# NOI2015 寿司晚宴

给出$n$，求有多少对集合 $S, T$ 满足 $S \cup T \subseteq [2, n], S \cap T = \varnothing$,
且 $\forall x \in S, y \in T \,\, \gcd(x, y) = 1$。

\vspace{2ex}

$n \le 500$

---

# NOI2015 寿司晚宴

记$dp(S, T)$表示两个集合中出现的质因子集合分别为$S, T$的方案数。
然后按顺序考虑每个数，可以根据当前的状态判断某个数是否能够放在 $S$ 集合或者 $T$ 集合中。

然而这样状态数还是太大了，还需要进一步的优化。

. . . 

由于在每个 $[2, n]$ 中的数里，大于 $\sqrt{n}$ 的质因子至多只有一个，
可以根据这个值将所有的数分组，每个组内部的数最大的质因子相同。

这样转移的时候保证每一组内的数最多只能选择一个，就能将状态数优化到可以接受的范围。
