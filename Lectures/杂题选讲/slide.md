% 杂题选讲
% Wearry
% Jan 17，2020

---

Best Subsequence
===

给出一个长度为 $n$ 的序列 $\{a_i\}$，求长度为 $k$ 的子序列 $\{a_{i_j}\}$，使得：

$$
\max\{ (a_{i_1} + a_{i_2}), (a_{i_2} + a_{i_3}), \dots, (a_{i_k} + a_{i_1}) \}
$$

最小，求最小值是多少。

\vspace{2ex}

$n, k \le 10^5, |a_i| \le 10^9$

---

Best Subsequence
===

- 对于要求最大值最小的题目，直接的想法是二分答案，考虑二分之后如何判断。\pause
- 记 $f_{i, j}$ 表示前 $i$ 个数中选择了 $j$ 个位置作为子序列，并且 $i$ 也在自序列中是否能够取到。
- 直接转移的复杂度是 $O(n^3)$ 的，利用数据结构优化可以做到 $O(n^2\log{n})$。\pause
- 注意到只记录 $0/1$ 状态损失了很多信息，考虑改成记录最大值的方式，注意到求最大值的过程是循环的，因此可以先将最小值循环移动到序列开头，由于最小值一定在一个最优方案中，因此只需要最长子序列的长度不小于 $k$ 即可。

---

Dates
===

你想要和 $t$ 个女孩在接下来的 $n$ 天中约会，其中第 $i$ 个女孩愿意在第 $[l_i, r_i]$ 中的某一天和你约会，如果成功约会你能够获得 $p_i$ 的愉悦度，并且满足 $l_i \le l_{i+1}, r_i \le r_{i+1}$。

然而你的精力有限，第 $i$ 天最多只能和 $a_i$ 个女孩约会，求你能获得的愉悦度的最大值。

\vspace{2ex}

$1 \le l_i \le r_i \le n, t \le 3\times 10^5, p_i \le 10^9$

---

Dates
===

考虑按照 $p_i$ 的顺序贪心地插入所有点，那么一定是能选就选，不能选就一定不选。

\pause

考虑二分图匹配的霍尔定理，由于区间之间没有包含的情况，因此只需要判断对于任意的 $l_i$ 连续的区间段，是否满足：

$$
r-l+1 \le \sum_{i=L(l)}^{R(r)} a_i
$$

简单变换式子可以得到：

$$
S_{R(r)} - r \ge S_{L(l)-1} - (l-1)
$$

---

Dates
===

$$
S_{R(r)} - r \ge S_{L(l)-1} - (l-1)
$$

又注意到选择 $[l, r]$ 这个区间至多只会影响所有跨越区间的部分的选择，因此只需要满足区间右侧的最小值大于等于左侧的最大值即可。

在线段树上分别维护 $S_{R(i)} - i$ 和 $S_{L(i) - 1} - (i-1)$ 即可。

---


Planes
===

给出一个 $n$ 个点 $m$ 条边的有向图，求最小路径覆盖数，并求可能成为最小路径覆盖方案中的路径的端点的点集。

\vspace{2ex}

$n, m \le 10^5$

---

Planes
===

首先对于最小路径覆盖数，可以将原图 $(u, v)$ 中的所有边加入新的二分图中作为边 $(u, v')$，然后求新的二分图的最大匹配，用总点数减去匹配数就可以得到最小路径覆盖数。

接着考虑可能成为端点的点集的性质，对于二分图匹配中的每一条匹配边，相当于最优方案中这条边也在某一条覆盖路径上，如果某个点 $x$ 是路径的端点，则相当于形如 $(x, y')$, $(y, x')$ 这样的边至少有一类不存在。

由于题目要求的是所有方案中可能的点集，因此只需要至少存在一个最大匹配的方案，满足上述形式的匹配边不存在即可，这样的问题与 $x$ 或 $x'$ 是非匹配点等价。而非匹配点有两类：

1. 在初始求出的匹配方案中的未配点。
2. 从一个未配点出发，能够经过交替路遍历到的同侧点。

于是直接在求出最大匹配的残图上进行一次 BFS 即可。

---

Knowledge
===

给出一个长度为 $n$ 字符串，仅包含 \textrm{a, b} 两种字符，你可以进行任意次如下操作：

- 删除 \textrm{aa}
- 删除 \textrm{bbb}
- 删除 \textrm{ababab}
- 添加 \textrm{aa}
- 添加 \textrm{bbb}
- 添加 \textrm{ababab}

求能够利用这种方法得到多少长度为 $x$ 的字符串。

\vspace{2ex}

$n \le 3 \times 10^5, x \le 10^9$

---

Knowledge
===

注意到：

- \textrm{abb} = \textrm{baba}
- \textrm{ababb} = \textrm{bbab}

\pause

因此长度超过一定大小时等价类的数量不超过 $20$，可以表示成 \textrm{bb} 的一个前缀加上 \textrm{ababa} 的一个前缀的形式，因此利用矩阵乘法即可计算答案。

---

Cool Pairs
===

给出两个排列 $\{p_i\}, \{q_i\}$，对于两个序列 $\{a_i\}, \{b_i\}$，
定义一个二元组 $(i, j)$ 是好的，当且仅当：

$$
i < j \,\, \mathrm{and} \,\, a_i + b_j < 0
$$

现在要求你构造两个序列 $\{a_i\}, \{b_i\}$ 值域在 $[-n, n]$, 
满足好的二元组数量恰好有 $k$ 个，并且有：

$$
\begin{aligned}
a_{p_1} \le a_{p_2} \le \dots \le a_{p_n} \\
b_{q_1} \le b_{q_2} \le \dots \le b_{q_n} \\
\end{aligned}
$$

\vspace{2ex}

$n \le 10^5, k \le {n \choose 2}$ 

---

Cool Pairs
===

认真观察可以发现，一定存在构造方案满足 $b_{q_i} = i-1$。

\pause
接下来考虑从小到大从初值为 $-n$ 开始填 $a_i$，如果在 $a_i$ 右边且满足条件的 $b_j$ 的数量大于等于 $k$，那么一定存在一种更大的取值能够恰好取到等号，剩下的其他 $a_i$ 则全部填 $0$ 即可。

\pause
否则保持 $a_i$ 的值为 $-n$ 不变，将当前的 $k$ 减掉 $a_i$ 产生的贡献进行迭代即可。

---

Cake
===

给出一个 $n$ 个点构成的凸包，现在你会随机从中选出 $k$ 个点，求选出的点都成的图形的期望面积。

\vspace{2ex}

$3 \le k \le n \le 2500$

---

Cake
===

利用期望的线性性，将图形的面积拆成图形所有边的两端点的叉积的和的形式。

\pause
这样问题转化成求一条边出现在图形边缘的概率，注意到这个概率其实就是一个组合数的形式，
因此直接 $O(n^2)$ 计算即可。

---

XOR
===

给定 $n, m$ 和 $2^m$ 个数 $\{p_i\}$，
保证 $[1,n]$ 至少在 $\{p_i\}$ 中出现一次。
求有多少组值域范围是 $[0, 2^m-1]$ 的长度为 $n$ 的序列 $\{x_i\}$ 满足：

$$
\forall y, y \oplus x_{p_y} > y \oplus x_{p_i}, \forall i \neq y
$$

\vspace{2ex}

$m \le 16, n \le 2^m$

---

XOR
===

考虑从高位向低位按位确定每一个位为 $0/1$，注意到对于当前位上为 $0$ 的那些位和当前位置为 $1$ 的那些位如果在 $p$ 的集合上出现交集，则必定最高位全为 $0$ 或者全部为 $1$。

\pause

否则，如果 $p$ 集合没有交集，则最高位上一定分别填 $0/1$ 来以此满足 $p$ 的性质。

---

Set
===

给出一个大小为$n$ 的正整数集合 $S$，判断是否能找到一个大小不小于 $\lfloor \frac{n}{3} \rfloor$ 的子集 $T$，满足不存在 $a, b \in T$ 且 $a+b \in T$，如果能则求出一组可能的解。

\vspace{2ex}

$n \le 10^6$

---

Set
===

首先答案一定是能，不过证明起来比较复杂。

\pause

考虑随机算法：

- 每次将所有的数乘上一个 $x$ 然后对 $p$ 取模
- 这样所有的数会几乎等概率分布在 $[0, p-1]$ 中
\pause
- 期望下分布在 $[\frac{1}{p}, \frac{2}{p}]$ 中的数的个数就是 $\frac{n}{3}$
- 多次随机找到合法方案的概率大约是 $1 - (\frac{2}{3})^k$，实际效果其实更好
